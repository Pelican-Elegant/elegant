(function(a){a.fn.tipuesearch=function(b){var c=a.extend({show:7,newWindow:false,showURL:true,minimumLength:3,descriptiveWords:25,highlightTerms:true,highlightEveryTerm:false,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json"},b);return this.each(function(){var g={pages:[]};a.ajaxSetup({async:false});if(c.mode=="live"){for(var h=0;h<tipuesearch_pages.length;h++){a.get(tipuesearch_pages[h],"",function(k){var i=a(c.liveContent,k).text();i=i.replace(/\s+/g," ");var n=a(c.liveDescription,k).text();n=n.replace(/\s+/g," ");var m=k.toLowerCase().indexOf("<title>");var l=k.toLowerCase().indexOf("</title>",m+7);if(m!=-1&&l!=-1){var j=k.slice(m+7,l)}else{var j="No title"}g.pages.push({title:j,text:n,tags:i,url:tipuesearch_pages[h]})})}}if(c.mode=="json"){a.getJSON(c.contentLocation,function(i){g=a.extend({},i)})}if(c.mode=="static"){g=a.extend({},tipuesearch)}var f="";if(c.newWindow){f=' target="_blank"'}function d(i){return decodeURIComponent((new RegExp("[?|&]"+i+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}if(d("q")){a("#tipue_search_input").val(d("q"));e(0,true)}a("#tipue_search_button").click(function(){e(0,true)});a(this).keyup(function(i){if(i.keyCode=="13"){e(0,true)}});function e(n,I){a("#tipue_search_content").hide();var D="";var z="";var A=false;var x=false;var G=a("#tipue_search_input").val().toLowerCase();G=a.trim(G);var j=G.split(" ");G="";for(var C=0;C<j.length;C++){var u=true;for(var F=0;F<tipuesearch_stop_words.length;F++){if(j[C]==tipuesearch_stop_words[F]){u=false;x=true}}if(u){G=G+" "+j[C]}}G=a.trim(G);j=G.split(" ");if(G.length>=c.minimumLength){if(I){var m=G;for(var C=0;C<j.length;C++){for(var F=0;F<tipuesearch_replace.words.length;F++){if(j[C]==tipuesearch_replace.words[F].word){G=G.replace(j[C],tipuesearch_replace.words[F].replace_with);A=true}}}j=G.split(" ")}var k=G;for(var C=0;C<j.length;C++){for(var F=0;F<tipuesearch_stem.words.length;F++){if(j[C]==tipuesearch_stem.words[F].word){k=k+" "+tipuesearch_stem.words[F].stem}}}j=k.split(" ");var H=0;found=new Array();for(var C=0;C<g.pages.length;C++){var E=1000000000;var v=g.pages[C].text;for(var F=0;F<j.length;F++){var w=new RegExp(j[F],"i");if(g.pages[C].title.search(w)!=-1){E-=(200000-C)}if(g.pages[C].text.search(w)!=-1){E-=(150000-C)}if(c.highlightTerms){if(c.highlightEveryTerm){var r=new RegExp("("+j[F]+")","gi")}else{var r=new RegExp("("+j[F]+")","i")}v=v.replace(r,"<b>$1</b>")}if(g.pages[C].tags.search(w)!=-1){E-=(100000-C)}}if(E<1000000000){found[H++]=E+"^"+g.pages[C].title+"^"+v+"^"+g.pages[C].url}}if(H!=0){if(A==1){D+='<div id="tipue_search_warning_head">Showing results for '+G+"</div>";D+='<div id="tipue_search_warning">Search for <a href="javascript:void(0)" id="tipue_search_replaced">'+m+"</a></div>"}if(H==1){D+='<div id="tipue_search_results_count">1 result</div>'}else{c_c=H.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");D+='<div id="tipue_search_results_count">'+c_c+" results</div>"}found.sort();var B=0;for(var C=0;C<found.length;C++){var p=found[C].split("^");if(B>=n&&B<c.show+n){D+='<div class="tipue_search_content_title"><a href="'+p[3]+'"'+f+">"+p[1]+"</a></div>";var y=p[2];var q="";var J=y.split(" ");if(J.length<c.descriptiveWords){q=y}else{for(var F=0;F<c.descriptiveWords;F++){q+=J[F]+" "}}q=a.trim(q);if(q.charAt(q.length-1)!="."){q+=" ..."}D+='<div class="tipue_search_content_text">'+q+"</div>";if(c.showURL){D+='<div class="tipue_search_content_loc"><a href="'+p[3]+'"'+f+">"+p[3]+"</a></div>"}}B++}if(H>c.show){var s=Math.ceil(H/c.show);var o=(n/c.show);D+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';if(n>0){D+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(n-c.show)+"_"+I+'">&#171; Prev</a></li>'}if(o<=2){var l=s;if(s>3){l=3}for(var F=0;F<l;F++){if(F==o){D+='<li class="current">'+(F+1)+"</li>"}else{D+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(F*c.show)+"_"+I+'">'+(F+1)+"</a></li>"}}}else{var l=s+2;if(l>s){l=s}for(var F=o;F<l;F++){if(F==o){D+='<li class="current">'+(F+1)+"</li>"}else{D+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(F*c.show)+"_"+I+'">'+(F+1)+"</a></li>"}}}if(o+1!=s){D+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(n+c.show)+"_"+I+'">Next &#187;</a></li>'}D+="</ul></div>"}}else{D+='<div id="tipue_search_warning_head">Nothing found</div>'}}else{if(x){D+='<div id="tipue_search_warning_head">Nothing found</div><div id="tipue_search_warning">Common words are largely ignored</div>'}else{D+='<div id="tipue_search_warning_head">Search too short</div>';if(c.minimumLength==1){D+='<div id="tipue_search_warning">Should be one character or more</div>'}else{D+='<div id="tipue_search_warning">Should be '+c.minimumLength+" characters or more</div>"}}}a("#tipue_search_content").html(D);a("#tipue_search_content").slideDown(200);a("#tipue_search_replaced").click(function(){e(0,false)});a(".tipue_search_foot_box").click(function(){var t=a(this).attr("id");var i=t.split("_");e(parseInt(i[0]),i[1])})}})}})(jQuery);